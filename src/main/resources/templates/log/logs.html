<html xmlns:th="https://www.thymeleaf.org">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<link rel="stylesheet" href="/css/bootstrap.css">
	<title>Logs - Versátil I.A.</title>
	<link rel="stylesheet" href="/css/font-awesome.min.css">
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
		integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
		crossorigin="anonymous"></script>
</head>
<style>
	.fonte-tabela {
		font-weight: 600;
		font-size: 80%;
	}
</style>

<body>
	<nav class="navbar navbar-light bg-light">
		<a class="navbar-brand" href="/"> <img src="/vst-ia.png" height="30" class="d-inline-block align-top" alt="">
			<span style="font-weight: 600">&nbsp;&nbsp;Logs</span>
		</a>
	</nav>
	<br>
	<div class="container">
		<div class="row">
			<div class="col-12">
				<div class="card">
					<div class="card-body">
						<div class="row">
							<div class="col-6 col-sm-2" align="right">
								<label for="conta"><strong>Período:</strong></label>
							</div>
							<div class="col-6 col-sm-2">
								<div id="dataInicialDatePicker" class="input-group date" data-date-format="dd/mm/yyyy">
									<input id="dataInicial" class="form-control" type="text" readonly /> <span
										class="input-group-addon"> <i class="glyphicon glyphicon-calendar"></i>
									</span>
								</div>
							</div>
							<div class="col-6 col-sm-1" align="center">
								<label><strong>até</strong></label>
							</div>
							<div class="col-6 col-sm-2">
								<div id="dataFinalDatePicker" class="input-group date" data-date-format="dd/mm/yyyy">
									<input id="dataFinal" class="form-control" type="text" readonly />
									<span class="input-group-addon"> <i class="glyphicon glyphicon-calendar"></i>
									</span>
								</div>
							</div>
							<div class="col-6 col-sm-2" align="right">
								<label><strong>Conteúdo:</strong></label>
							</div>
							<div class="col-6 col-sm-3">
								<input id="conteudo" class="form-control">
							</div>
						</div>
						<div class="row">
							<div class="col-6 col-sm-2" align="right">
								<label for="conta"><strong>Contas:</strong></label>
							</div>
							<div class="col-6 col-sm-2">
								<input class="form-control" id="conta1">
							</div>
							<div class="col-6 col-sm-1" align="right">&nbsp;</div>
							<div class="col-6 col-sm-2">
								<input class="form-control" id="conta2">
							</div>

						</div>
						<hr>
						<div class="row">
							<div class="col-4 col-sm-2" align="right">
								<label for="conta"><strong>Filtro Rápido:</strong></label>
							</div>
							<div class="col-4 col-sm-6">
								<button class="btn btn-danger btn-sm"
									onclick="javascript:filtrarConteudo('error');">Error</button>
								&nbsp;
								<button class="btn btn-success btn-sm"
									onclick="javascript:filtrarConteudo('conectado');">Conectado</button>
							</div>
							<div class="col-4 col-sm-4" align="right">
								<button class="btn btn-primary" onclick="javascript:filtrar();">Filtrar</button>
								&nbsp;
								<button class="btn btn-secondary" onclick="javascript:limparCampos();">Limpar</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<br>
		<div class="row">
			<div class="col-12" id="divTabela">
				<table class="table table-striped" id="tabelaLog">
					<thead>
						<tr>
							<th class="fonte-tabela">Data</th>
							<th class="fonte-tabela">Conta</th>
							<th class="fonte-tabela">&nbsp;</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="log : ${logsList}">
							<td><span class="fonte-tabela"
									th:text="${#temporals.format(log.dataHora, 'dd/MM/yy HH:mm:ss')}"></span></td>
							<td><span class="fonte-tabela" th:text="${log.conta}"></span></td>
							<td style="word-wrap: break-word; min-width: 160px; max-width: 500px;"><span
									class="fonte-tabela" th:text="${log.comando}"></span></td>
						</tr>
						<tr>
							<td colspan="3"><span th:text="${logsList.size()}"></span></td>
						</tr>
					</tbody>
				</table>

			</div>
		</div>
	</div>
</body>
<script type="text/javascript" src="/js/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="/js/jquery.form.js"></script>
<script type="text/javascript" src="/js/jquery.mask.min.js"></script>
<script type="text/javascript" src="/js/jquery.price_format.1.7.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"
	type="text/javascript">

	</script>
<script type="text/javascript" src="/js/versatil.js"></script>
<script type="text/javascript">
	function filtrar() {
		var request = {};
		request.conta1 = $('#conta1').val();
		request.conta2 = $('#conta2').val();
		request.dataInicial = ($('#dataInicial').val()).split('/').reverse()
			.join('-');
		request.dataFinal = ($('#dataFinal').val()).split('/').reverse().join(
			'-');
		request.conteudo = $('#conteudo').val();
		$("#tabelaLog tbody tr").each(function () {
			this.parentNode.removeChild(this);
		});

		$
			.ajax({
				url: "/log/filtrar",
				type: "POST",
				data: JSON.stringify(request),
				// dataType : "json",
				contentType: "application/json; charset=utf-8",
				success: function () {
				}
			})
			.done(
				function (logs) {
					logs
						.forEach(function (log) {
							var colunaDataHora = '<td><span class="fonte-tabela">'
								+ log.dataHora + '</span></td>';
							var colunaConta = '<td><span class="fonte-tabela">'
								+ log.conta + '</span></td>';
							var colunaComando = '<td style="word-wrap: break-word; min-width: 160px; max-width: 500px;"><span class="fonte-tabela">'
								+ log.comando + '</span></td>';
							var linha = '<tr>' + colunaDataHora
								+ colunaConta + colunaComando
								+ '</tr>';
							$("#tabelaLog").find('tbody').append(
								linha);
						});
				}).fail(function (response) {
					var error = JSON.parse(response.responseText);
					console.log(error);
				});
	}

	function filtrarConteudo(conteudo) {
		$('#conteudo').val(conteudo);
		filtrar();
	}

	function limparCampos() {
		$('#conteudo').val('');
		$('#conta1').val('');
		$('#conta2').val('');

		$('#dataInicial').val(formatarDateToDdMmYyyy(new Date()));
		$('#dataFinal').val(formatarDateToDdMmYyyy(new Date()));

		filtrar();
	}

	$(function () {
		$("#dataInicialDatePicker").datepicker({
			autoclose: true,
			todayHighlight: true,
		}).datepicker('update', new Date());
		$("#dataFinalDatePicker").datepicker({
			autoclose: true,
			todayHighlight: true,
		}).datepicker('update', new Date());
	});
</script>

</html>