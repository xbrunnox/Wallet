<!doctype html>
<html xmlns:th="https://www.thymeleaf.org">
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=yes">
<link rel="stylesheet" href="/css/bootstrap.css">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
	integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
	crossorigin="anonymous"></script>
<!-- link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
	crossorigin="anonymous" -->
<title>Detalhes de conta - Versatil IA</title>
<link rel="stylesheet" href="/css/font-awesome.min.css">
<style>
.fonte-tabela {
	font-weight: 700;
	font-size: 65%;
}

.badge-dollar {
	color: white;
	background-color: deepskyblue;
	font-size: 70%;
}

.badge-green {
	color: white;
	background-color: #28a745;
	font-size: 70%;
}

.badge-venda {
	color: white;
	background-color: brown;
	font-size: 70%;
}

.badge-compra {
	color: white;
	background-color: darkslateblue;
	font-size: 70%;
}
</style>
</head>
<body>
	<nav class="navbar navbar-light bg-light">
		<a class="navbar-brand" href="/"> <img src="/vst-ia.png"
			height="30" class="d-inline-block align-top" alt=""> <span
			style="font-weight: 600">&nbsp;&nbsp;Detalhes de conta</span>
		</a>
	</nav>
	<br>
	<div class="container-md">

		<br>
		<div class="row">
			<div class="col">
				<h5>Dados de Conta</h5>
			</div>
		</div>
		<hr style="margin-top: auto;">
		<div class="row">
			<div class="col-2" align="right">
				<label><strong>Conta:</strong></label>
			</div>
			<div class="col-2" th:text="${conta.id}"></div>
			<div class="col-2" align="right">
				<label><strong>Venc.:</strong></label>
			</div>
			<div class="col-4">
				<span
					th:text="${assinatura != null ? #temporals.format(assinatura.dataVencimento, 'dd/MM/yyyy'):''}"></span>
				&nbsp;<a href="javascript:alterarVencimentoModal();"><i
					class="bi bi-pencil-square"></i></a>
			</div>
		</div>
		<div class="row">
			<div class="col-2" align="right">
				<label><strong>Nome:</strong></label>
			</div>
			<div class="col-10" th:text="${conta.nome}"></div>
		</div>
		<div class="row">
			<div class="col-2" align="right">
				<label><strong>Corretora:</strong></label>
			</div>
			<div class="col-10" th:text="${conta.corretora}"></div>
		</div>
		<div class="row">
			<div class="col-2" align="right">
				<label><strong>E-mail:</strong></label>
			</div>
			<div class="col-10">
				<span
					th:text="${assinatura != null ? assinatura.emailPagamento : ''}"></span>
				&nbsp;<a href="javascript:alterarEmailModal();"><i
					class="bi bi-pencil-square"></i></a>
			</div>
		</div>
		<div class="row">
			<div class="col-2" align="right">
				<label><strong>Telefone:</strong></label>
			</div>
			<div class="col-10"
				th:text="${assinatura != null ? assinatura.telefone : ''}"></div>
		</div>
		<div class="row">
			<div class="col-2" align="right">
				<label><strong>Instalação:</strong></label>
			</div>
			<div class="col-10"
				th:text="${assinatura != null ? assinatura.maquina : ''}"></div>
		</div>

		<div class="row">
			<div class="col-2" align="right">
				<label><strong>Total:</strong></label>
			</div>
			<div class="col-10"
				th:text="${#numbers.formatDecimal(total, 1,'POINT', 2, 'COMMA')}"></div>
		</div>
		<br> <br>

		<div th:if="${assinatura != null}">
			<input type="hidden" id="idAssinatura" th:value="${assinatura.id}">
			<div class="row">
				<div class="col-8">
					<h5>Sub Contas</h5>
				</div>
				<div class="col-4" align="right">
					<button class="btn btn-sm btn-primary"
						onclick="javascript:adicionarSubConta();">+</button>
				</div>
			</div>
			<hr style="margin-top: auto;">
			<div class="row"
				th:if="${subContaList == null || subContaList.isEmpty()}">
				<div class="col-12">Não possui subcontas.</div>
			</div>
			<div class="row"
				th:if="${subContaList != null && subContaList.size() > 0}">
				<div class="col-12">
					<table class="table table-striped">
						<thead>
							<tr>
								<th>ID</th>
								<th>Conta</th>
								<th>Nome</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="subconta : ${subContaList}">
								<td><span th:text="${subconta.id}"></span></td>
								<td><span th:text="${subconta.conta.id}"></span></td>
								<td><span th:text="${subconta.conta.nome}"></span></td>
							</tr>
						</tbody>
					</table>

				</div>
			</div>
			<br>
			<div class="row">
				<div class="col">
					<h5>Pagamentos Recebidos</h5>
				</div>
			</div>
			<hr style="margin-top: auto;">
			<div class="row">
				<div class="col">
					<table class="table table-striped">
						<thead>
							<tr>
								<th>Data</th>
								<th>Nome</th>
								<th style="text-align: right;">Email/Telefone</th>
								<th style="text-align: right;">Valor</th>
								<th>&nbsp;</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="assinaturaPagamento : ${pagamentosList}">
								<td class="fonte-tabela"><span
									th:text="${#temporals.format(assinaturaPagamento.pagamento.dataAtualizacao, 'dd/MM/yyyy')}"></span>
									<br> <small><span
										th:text="${#temporals.format(assinaturaPagamento.pagamento.dataAtualizacao, 'HH:mm:ss')}"></span></small>
								</td>
								<td class="fonte-tabela"><span
									th:text="${assinaturaPagamento.pagamento.nome}"></span> <br>
									<small><span
										th:text="${assinaturaPagamento.pagamento.plataforma +'-'+ assinaturaPagamento.pagamento.refPedido}"></span></small></td>

								<td class="fonte-tabela" align="right"><span
									th:text="${assinaturaPagamento.pagamento.email}"></span><br>
									<small><span
										th:text="${assinaturaPagamento.pagamento.telefone}"></span></small></td>
								<td class="fonte-tabela" align="right"><span
									th:text="${#numbers.formatDecimal(assinaturaPagamento.pagamento.valor, 1, 'POINT', 2, 'COMMA')}"></span></td>
								<td>
									<div class="btn-group">
										<button type="button"
											class="btn btn-sm btn-danger dropdown-toggle"
											data-toggle="dropdown" aria-expanded="false">
											<i class="bi bi-gear-fill"></i>
										</button>
										<div class="dropdown-menu">
											<!-- Excluir Pagamento -->
											<a class="dropdown-item"
												th:href="@{'javascript:excluirPagamentoModal(' + ${assinaturaPagamento.id} +');'}">
												Excluir </a>
										</div>
									</div>

								</td>
							</tr>
							<tr>
								<td colspan="4"><span class="fonte-tabela"
									th:text="${pagamentosList.size()}"></span></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<br> <br>


			<div class="row">
				<div class="col">
					<h5>Automações</h5>
				</div>
				<div class="col" align="right">
					<a class="btn btn-primary btn-sm"
						th:href="@{'/expert/delta/' + ${assinatura.id}}"> <span>Subst.
							por Delta</span></a>
				</div>
			</div>
			<hr style="margin-top: auto;">
			<div class="row">
				<div class="col">
					<table class="table table-striped">
						<thead>
							<tr>
								<th>ID</th>
								<th>Expert</th>
								<th>Alavancagem</th>
								<th>Alavancagem Máxima</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="expert : ${expertList}">
								<td class="fonte-tabela"><span th:text="${expert.id}"></span>
								</td>
								<td class="fonte-tabela"><span
									th:text="${expert.expert.id}"></span></td>
								<td class="fonte-tabela"><span th:text="${expert.volume}"></span></td>
								<td class="fonte-tabela"><span
									th:text="${expert.volumeMaximo}"></span></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<br> <br>

			<div class="row">
				<div class="col">
					<h5>Trades Realizados</h5>
				</div>
			</div>
			<hr style="margin-top: auto; margin-bottom: auto;">
			<div class="row">
				<div class="col">
					<table class="table table-striped">
						<thead>
							<tr>
								<th style="text-align: left; font-size: 70%;">Data</th>
								<th style="text-align: center; font-size: 70%;">Ativo <br>
									Vol.
								</th>
								<th class="d-none d-sm-block"
									style="text-align: right; font-size: 70%;">Duração<br>&nbsp;
								</th>
								<th style="text-align: center; font-size: 70%;">Venda <br>
									Compra
								</th>
								<th style="text-align: right; font-size: 70%;">Pontos<br>&nbsp;
								</th>
								<th style="text-align: right; font-size: 70%;">Result.</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="trade : ${tradesList}">
								<td
									th:text="${#temporals.format(trade.dataEntrada, 'dd/MM/yy')}"
									class="fonte-tabela"></td>
								<td align="center"><span
									th:class="${trade.ativo.codigo.startsWith('WIN') ? 'badge badge-green': 'badge badge-dollar'}"
									th:text="${trade.ativo.codigo}"></span><br> <span
									th:class="${trade.direcao.equals('C') ? 'badge badge-compra': 'badge badge-venda'}"
									th:text="${trade.volume +' '+ trade.direcao}"></span></td>
								<td class="d-none d-sm-block" align="right"><span
									class="fonte-tabela" th:text="${trade.getDuracaoFormatada()}"></span><br>
									<span>&nbsp;</span></td>
								<td align="center"><span class="fonte-tabela"
									th:text="${#numbers.formatDecimal(trade.compra, 1, 'POINT', 2, 'COMMA')}"></span><br>
									<span class="fonte-tabela"
									th:text="${#numbers.formatDecimal(trade.venda, 1, 'POINT', 2, 'COMMA')}"></span>
								</td>
								<td align="right"><span class="fonte-tabela"
									th:text="${#numbers.formatDecimal(trade.pontos, 1, 'POINT', 2, 'COMMA')}"></span>
								</td>
								<td align="right"><span style="font-size: 70%;"
									th:class="${trade.resultado >= 0 ? 'badge text-bg-success': 'badge text-bg-danger'}"
									th:text="${#numbers.formatDecimal(trade.resultado, 1, 'POINT', 2, 'COMMA')}"></span>
								</td>
							</tr>
							<tr>
								<td th:text="${contas}"></td>
								<td class="d-none d-sm-block" align="right">&nbsp;</td>
								<td colspan="3" align="right"><Strong>Total:</Strong></td>
								<td
									th:text="${#numbers.formatDecimal(total, 1,'POINT', 2, 'COMMA')}"
									style="font-weight: bold;" align="right"></td>
							</tr>
						</tbody>
						<!-- tbody>
						<tr th:each="trade : ${tradesList}">
							<td th:text="${#temporals.format(trade.dataEntrada, 'dd/MM/yy')}"
								class="fonte-tabela"></td>
							<td><span
								th:class="${trade.ativo.codigo.startsWith('WIN') ? 'badge badge-green': 'badge badge-dollar'}"
								th:text="${trade.ativo.codigo}"></span></td>
							<td><span
								th:class="${trade.direcao.equals('C') ? 'badge badge-compra': 'badge badge-venda'}"
								th:text="${trade.volume +' '+ trade.direcao}"></span></td>
							<td class="d-none d-sm-block" align="right"><span
								class="fonte-tabela"
								th:text="${trade.getDuracaoFormatada()}"></span></td>
							<td align="right"><span
								class="fonte-tabela"
								th:text="${#numbers.formatDecimal(trade.compra, 1, 'POINT', 2, 'COMMA')}"></span>
							</td>
							<td align="right"><span
								class="fonte-tabela"
								th:text="${#numbers.formatDecimal(trade.venda, 1, 'POINT', 2, 'COMMA')}"></span>
							</td>
							<td align="right"><span
								class="fonte-tabela"
								th:text="${#numbers.formatDecimal(trade.pontos, 1, 'POINT', 2, 'COMMA')}"></span>
							</td>
							<td align="right"><span style="font-size: 70%;"
								th:class="${trade.resultado >= 0 ? 'badge text-bg-success': 'badge text-bg-danger'}"
								th:text="${#numbers.formatDecimal(trade.resultado, 1, 'POINT', 2, 'COMMA')}"></span>
							</td>
						</tr>
						<tr>
							<td th:text="${contas}"></td>
							<td class="d-none d-sm-block" align="right">&nbsp;</td>
							<td colspan="5" align="right"><Strong>Total:</Strong></td>
							<td
								th:text="${#numbers.formatDecimal(total, 1,'POINT', 2, 'COMMA')}"
								style="font-weight: bold;" align="right"></td>
						</tr>
					</tbody-->
					</table>

				</div>
			</div>
		</div>
	</div>
	<!-- Modal -->
	<div class="modal fade" id="adicionarSubContaModal" tabindex="-1"
		role="dialog" aria-labelledby="adicionarSubContaModalLabel"
		aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="adicionarSubContaModalLabel">Adicionar
						Sub Conta</h5>
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="row">
						<div class="col-3" align="right">
							<strong><label>Conta:</label></strong>
						</div>
						<div class="col-9">
							<select class="form-control" id="selectSubContas">
							</select>
						</div>
					</div>
					<div class="row">
						<div class="col-3" align="right">
							<strong><label>Automação:</label></strong>
						</div>
						<div class="col-9">
							<select class="form-control" id="selectAutomacoesAtivas">
								<option value="SWING">SWING</option>
								<option value="SWING">SWING2</option>
								<option value="SWING">SWING3</option>
								<option value="SWING">SWING4</option>
								<option value="SWING">SWING5</option>
							</select>
						</div>
					</div>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-primary"
						onclick="javascript:associarSubConta();">Adicionar</button>
					<button type="button" class="btn btn-secondary"
						data-dismiss="modal">Cancelar</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Modal Alterar Vencimento -->
	<div class="modal fade" id="alterarVencimentoModal" tabindex="-1"
		role="dialog" aria-labelledby="alterarVencimentoModalLabel"
		aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Alterar
						Vencimento</h5>
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="row">
						<div class="col-3" align="right">
							<label>Vencimento:</label>
						</div>
						<div class="col-4">
							<input class="form-control" id="vencimentoAtual" disabled>
						</div>
					</div>
					<div class="row">
						<div class="col-3" align="right">
							<label>Novo Vencimento:</label>
						</div>
						<div class="col-4">
							<div id="novoVencimentoDatePicker" class="input-group date"
								data-date-format="dd/mm/yyyy">
								<input id="novoVencimento" class="form-control" type="text"
									readonly /> <span class="input-group-addon"> <i
									class="glyphicon glyphicon-calendar"></i>
								</span>
							</div>
							<!-- 
							<input class="form-control" id="novoVencimento"> -->
						</div>
					</div>
					<div class="row">
						<div class="col-3" align="right">
							<label>Motivo:</label>
						</div>
						<div class="col-9">
							<textarea class="form-control" id="motivoAlteracaoVencimento"
								rows="3" cols=""></textarea>
						</div>
					</div>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-primary"
						onclick="javascript:alterarVencimento();">Gravar</button>
					<button type="button" class="btn btn-secondary"
						data-dismiss="modal">Cancelar</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal Alterar Email -->
	<div class="modal fade" id="alterarEmailModal" tabindex="-1"
		role="dialog" aria-labelledby="alterarEmailModalLabel"
		aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Alterar E-mail</h5>
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="row">
						<div class="col-3" align="right">
							<label>E-mail Atual:</label>
						</div>
						<div class="col-9">
							<input class="form-control" id="emailAtual" disabled>
						</div>
					</div>
					<div class="row">
						<div class="col-3" align="right">
							<label>Novo E-mail:</label>
						</div>
						<div class="col-9">
							<input id="novoEmail" class="form-control" type="text" />
						</div>
					</div>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-primary"
						onclick="javascript:alterarEmail();">Gravar</button>
					<button type="button" class="btn btn-secondary"
						data-dismiss="modal">Cancelar</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal Excluir Pagamento -->
	<div class="modal fade" id="excluirPagamentoModal" tabindex="-1"
		role="dialog" aria-labelledby="excluirPagamentoModalLabel"
		aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="excluirPagamentoModalLabel">Excluir
						Pagamento</h5>
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="row">
						<div class="col-3" align="right">
							<label><strong>ID:</strong></label>
						</div>
						<div class="col-3">
							<input class="form-control" id="idPagamentoExcluir" disabled>
						</div>
						<div class="col-3" align="right">
							<label><strong>Valor:</strong></label>
						</div>
						<div class="col-3">
							<input id="valorPagamentoExcluir" class="form-control"
								type="text" style="text-align: right;"/>
						</div>
					</div>
					<div class="row">
						<div class="col-3" align="right">
							<label><strong>Nome:</strong></label>
						</div>
						<div class="col-9">
							<input id="nomePagamentoExcluir" class="form-control" type="text" />
						</div>
					</div>
					<div class="row">
						<div class="col-3" align="right">
							<label><strong>Produto:</strong></label>
						</div>
						<div class="col-9">
							<input id="produtoPagamentoExcluir" class="form-control"
								type="text" />
						</div>
					</div>
					<div class="row">
						<div class="col-3" align="right">
							<label><strong>Plataforma:</strong></label>
						</div>
						<div class="col-3">
							<input id="plataformaPagamentoExcluir" class="form-control"
								type="text" />
						</div>
						<div class="col-2" align="right">
							<label><strong>Data:</strong></label>
						</div>
						<div class="col-4">
							<input id="dataPagamentoExcluir" class="form-control" type="text" />
						</div>
					</div>
					<div class="row">
						<div class="col-3" align="right">
							<label><strong>Email:</strong></label>
						</div>
						<div class="col-9">
							<input id="emailPagamentoExcluir" class="form-control"
								type="text" />
						</div>
					</div>
					<div class="row"></div>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-danger"
						onclick="javascript:excluirPagamento();">Excluir</button>
					<button type="button" class="btn btn-secondary"
						data-dismiss="modal">Cancelar</button>
				</div>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript" src="/js/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="/js/jquery.form.js"></script>
<script type="text/javascript" src="/js/jquery.mask.min.js"></script>
<script type="text/javascript" src="/js/jquery.price_format.1.7.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/series-label.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js">
	
</script>
<!-- script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
		crossorigin="anonymous"></script>
<!-- script type="text/javascript" src="/js/bootstrap.min.js"></script-->
<script>
	function alterarVencimentoModal() {
		$.ajax({
			url : '/assinatura/get/' + $('#idAssinatura').val(),
			success : function(assinatura) {
				$('#vencimentoAtual').val(
						assinatura.dataVencimento.split('-').reverse()
								.join('/'));
			}
		});

		$('#alterarVencimentoModal').modal({
			show : true
		});
	}

	function alterarEmailModal() {
		$.ajax({
			url : '/assinatura/get/' + $('#idAssinatura').val(),
			success : function(assinatura) {
				console.log(assinatura);
				$('#emailAtual').val(assinatura.email);
			}
		});

		$('#alterarEmailModal').modal({
			show : true
		});
	}

	function excluirPagamentoModal(idPagamento) {
		console.log('Excluindo pagamento ' + idPagamento);
		$.ajax({
			url : '/assinatura/get-pagamento/' + idPagamento,
			success : function(pagamento) {
				console.log(pagamento);

				$('#idPagamentoExcluir').val(pagamento.id);
				$('#nomePagamentoExcluir').val(pagamento.nome);
				$('#valorPagamentoExcluir').val(formatarDecimal(pagamento.valor, 2));
				$('#plataformaPagamentoExcluir').val(pagamento.plataforma);
				$('#emailPagamentoExcluir').val(pagamento.email);
				$('#dataPagamentoExcluir').val(
						parseISOLocal(pagamento.data).toLocaleString());
				$('#produtoPagamentoExcluir').val(pagamento.produto);

				$('#excluirPagamentoModal').modal({
					show : true
				});
			}
		});
	}

	function parseISOLocal(s) {
		var b = s.split(/\D/);
		return new Date(b[0], b[1] - 1, b[2], b[3], b[4], b[5]);
	}

	function excluirPagamento() {
		var request = {};
		request.id = $('#idPagamentoExcluir').val();
		request.idAssinatura = $('#idAssinatura').val();

		$.ajax({
			url : "/assinatura/excluir-pagamento",
			type : "POST",
			data : JSON.stringify(request),
			// dataType : "json",
			contentType : "application/json; charset=utf-8",
			success : function() {
				location.reload(true);
			}
		}).fail(function(response) {
			var error = JSON.parse(response.responseText);
			console.log(error);
			alert(error.message);
		});
	}

	function alterarVencimento() {
		var request = {};
		request.dataVencimento = ($('#vencimentoAtual').val()).split('/')
				.reverse().join('-');
		request.novoVencimento = ($('#novoVencimento').val()).split('/')
				.reverse().join('-');
		request.idAssinatura = $('#idAssinatura').val();
		request.motivo = $('#motivoAlteracaoVencimento').val();

		console.log(request);

		$.ajax({
			url : "/assinatura/alterar-vencimento",
			type : "POST",
			data : JSON.stringify(request),
			// dataType : "json",
			contentType : "application/json; charset=utf-8",
			success : function() {
				location.reload(true);
			}
		}).fail(function(response) {
			var error = JSON.parse(response.responseText);
			console.log(error);
			alert(error.message);
		});

	}

	function alterarEmail() {
		var request = {};
		request.emailAtual = $('#emailAtual').val();
		request.novoEmail = $('#novoEmail').val();
		request.idAssinatura = $('#idAssinatura').val();

		console.log(request);

		$.ajax({
			url : "/assinatura/alterar-email",
			type : "POST",
			data : JSON.stringify(request),
			// dataType : "json",
			contentType : "application/json; charset=utf-8",
			success : function() {
				location.reload(true);
			}
		}).fail(function(response) {
			var error = JSON.parse(response.responseText);
			console.log(error);
			alert(error.message);
		});

	}

	function adicionarSubConta() {
		console.log('Exibindo modal de subcontas')
		$.ajax({
			url : '/conta/inativas',
			success : function(contas) {
				console.log(contas);
				$.each(contas, function(key, conta) {
					$("#selectSubContas").append(
							'<option value=' + conta.id + '>' + conta.id
									+ ' - ' + conta.nome + '</option>');
				})
			}
		});
		$.ajax({
			url : '/automacao/ativas',
			success : function(automacoes) {
				console.log(automacoes);
				$.each(automacoes, function(key, automacao) {
					/**
					$("#selectAutomacoesAtivas").append(
							'<option value=' + automacao.id + '>'
									+ automacao.id + '</option>');
					 */
				})
			}
		});

		$('#adicionarSubContaModal').modal({
			show : true
		});
	}

	function associarSubConta() {
		var subConta = $('#selectSubContas').val();
		var automacao = $('#selectAutomacoesAtivas').val();
		var idAssinatura = $('#idAssinatura').val();

		console.log('Associando ' + subConta + ' com ' + automacao
				+ ' na assinatura ' + idAssinatura);

		$.ajax({
			url : '/subconta/associar/' + idAssinatura + '/' + subConta + '/'
					+ automacao,
			success : function() {
				alert('Associado com sucesso');
				location.reload(true);
			},
			error : function(errorMessage) {
				console.log(errorMessage);
				alert('Não foi possível associar esta conta.');
			}
		});
	}

	function formatarNumero(numero) {
		if (!numero)
			return '-';
		return numero.toLocaleString('pt-BR'); // "9.876.543,21"
	}

	function formatarDecimal(numero) {
		if (!numero)
			return '-';
		return numero.toLocaleString('pt-BR', {
			minimumFractionDigits : 2,
			maximumFractionDigits : 2
		}); // "9.876.543,21"
	}

	function formatarDecimal(numero, casasDecimais) {
		if (!numero)
			return '-';
		return numero.toLocaleString('pt-BR', {
			minimumFractionDigits : casasDecimais,
			maximumFractionDigits : casasDecimais
		}); // "9.876.543,21"
	}

	Highcharts.chart('container', {

		title : {
			text : 'Resultado'
		},

		subtitle : {
			text : 'Trades realizados'
		},

		yAxis : {
			title : {
				text : 'Resultado (R$)'
			}
		},

		xAxis : {
			accessibility : {
				rangeDescription : 'Período'
			},
			categories : [ 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul',
					'Aug', 'Sep', 'Oct', 'Nov', 'Dec' ]
		},

		legend : {
			layout : 'vertical',
			align : 'right',
			verticalAlign : 'middle'
		},

		series : [
				{
					name : 'Installation & Developers',
					data : [ 43934, 48656, 65165, 81827, 112143, 142383,
							171533, 165174, 155157, 161454, 154610 ]
				},
				{
					name : 'Manufacturing',
					data : [ 24916, 37941, 29742, 29851, 32490, 30282, 38121,
							36885, 33726, 34243, 31050 ]
				},
				{
					name : 'Sales & Distribution',
					data : [ 11744, 30000, 16005, 19771, 20185, 24377, 32147,
							30912, 29243, 29213, 25663 ]
				},
				{
					name : 'Operations & Maintenance',
					data : [ null, null, null, null, null, null, null, null,
							11164, 11218, 10077 ]
				},
				{
					name : 'Other',
					data : [ 21908, 5548, 8105, 11248, 8989, 11816, 18274,
							17300, 13053, 11906, 10073 ]
				} ],

		responsive : {
			rules : [ {
				condition : {
					maxWidth : 500
				},
				chartOptions : {
					legend : {
						layout : 'horizontal',
						align : 'center',
						verticalAlign : 'bottom'
					}
				}
			} ]
		}

	});
</script>
<script>
	$(function() {
		$("#novoVencimentoDatePicker").datepicker({
			autoclose : true,
			todayHighlight : true,
		}).datepicker('update', new Date());
	});
</script>
</html>