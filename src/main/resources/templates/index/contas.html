<html xmlns:th="https://www.thymeleaf.org">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<link rel="stylesheet" href="/css/bootstrap.css">
	<title>Contas</title>
	<link rel="stylesheet" href="/css/font-awesome.min.css">
</head>
<style>
	.fonte-tabela {
		font-weight: 600;
		font-size: 80%;
	}
</style>

<body>
	<nav class="navbar navbar-light bg-light">
		<a class="navbar-brand" href="/">
			<img th:src="${'https://download.versatil-ia.com.br/' + afiliado.logo}" height="30"
				class="d-inline-block align-top" alt="${'https://download.versatil-ia.com.br/tradingnow-favicon.png'}">
			<span style="font-weight: 600">&nbsp;&nbsp;Contas</span>
		</a>
	</nav>
	<br>
	<div class="container-fluid">

		<div class="row">
			<div class="col-12">
				<table class="table table-striped">
					<thead>
						<tr>
							<th class="fonte-tabela">Conta</th>
							<th class="fonte-tabela">Nome / Corretora</th>
							<th class="fonte-tabela" style="text-align: right;">Resultado</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="conta : ${contasList}">
							<td>
								<a th:href="@{'/detalhes/' + ${conta.id}}"> <span class="fonte-tabela"
										th:text="${conta.id}"></span></a><br> <small><span class="fonte-tabela"
										th:text="${#temporals.format(conta.dataDeVencimento, 'dd/MM/yyyy')}"></span></small>


								<!-- span class="fonte-tabela" th:text="${conta.id}"></span><br>
								<small><span class="fonte-tabela"
									th:text="${#temporals.format(conta.dataDeVencimento, 'dd/MM/yyyy')}"></span></small-->
							</td>
							<td><span class="fonte-tabela" th:text="${conta.nome}"></span><br>
								<small><span th:text="${conta.corretora}"></span></small>
							</td>

							<td class="fonte-tabela" align="right"><a th:href="@{'/trade/' + ${conta.id}}"> <span
										th:class="${conta.resultado >= 0 ? 'badge badge-success': 'badge badge-danger'}"
										th:text="${#numbers.formatDecimal(conta.resultado, 1, 'POINT', 2, 'COMMA')}"></span>
								</a></td>
						</tr>
						<tr>
							<td th:text="${contas}" class="fonte-tabela"></td>
							<td align="right" class="fonte-tabela"><Strong>Total:</Strong></td>
							<td style="font-weight: bold;" align="right"><span
									th:text="${#numbers.formatDecimal(total, 1,'POINT', 2, 'COMMA')}"></span>
							</td>
						</tr>
					</tbody>
				</table>

			</div>
		</div>
	</div>
</body>
<script type="text/javascript" src="/js/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="/js/jquery.form.js"></script>
<script type="text/javascript" src="/js/jquery.mask.min.js"></script>
<script type="text/javascript" src="/js/jquery.price_format.1.7.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script>
	function consultar() {
		$.ajax({
			url: '/delta/resumo',
			success: function (resumo) {
				console.log(resumo);

				var html = '';
				html += '<table class="table table-striped table-condensed">';
				html += '<thead>';
				html += '<th>Data</th>';
				html += '<th align="right">VWAP</th>';
				html += '<th align="right">Delta</th>';
				html += '<th align="right">Máx./Mín.</th>';
				html += '<th align="right">Amplit.</th>';
				html += '</thead>';
				html += '<tbody>';
				$.each(resumo.deltas, function (index, delta) {
					html += '<tr>';
					// 2021-10-12
					html += '<td>' + delta.data.substring(8, 10) + '/'
						+ delta.data.substring(5, 7) + '</td>';
					html += '<td align="right">'
						+ formatarDecimal(delta.vwapSuperior) + '<br>'
						+ formatarNumero(delta.vwapInferior) + '</td>';
					html += '<td align="right">' + formatarDecimal(delta.delta)
						+ '</td>';
					html += '<td align="right">'
						+ formatarDecimal(delta.maxima) + '<br>'
						+ formatarDecimal(delta.minima) + '</td>';
					html += '<td align="right">'
						+ formatarDecimal(delta.amplitude) + '</td>';
					html += '</tr>';
				});
				html += '<tr>';
				html += '<tbody>';
				html += '</table>';
				$('#vwapSuperior')
					.html(formatarDecimal(resumo.vwapSuperior, 0));
				$('#vwapInferior')
					.html(formatarDecimal(resumo.vwapInferior, 0));
				$('#delta').html(formatarDecimal(resumo.delta, 0));
				$('#amplitude').html(formatarDecimal(resumo.amplitude, 0));
				$('#conteudo').html(html);
			}
		});
	}

	function formatarNumero(numero) {
		if (!numero)
			return '-';
		return numero.toLocaleString('pt-BR'); // "9.876.543,21"
	}

	function formatarDecimal(numero) {
		if (!numero)
			return '-';
		return numero.toLocaleString('pt-BR', {
			minimumFractionDigits: 2,
			maximumFractionDigits: 2
		}); // "9.876.543,21"
	}

	function formatarDecimal(numero, casasDecimais) {
		if (!numero)
			return '-';
		return numero.toLocaleString('pt-BR', {
			minimumFractionDigits: casasDecimais,
			maximumFractionDigits: casasDecimais
		}); // "9.876.543,21"
	}
</script>

</html>